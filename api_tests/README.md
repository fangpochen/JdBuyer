# 京东API接口测试工具

## 📁 目录说明

```
api_tests/
├── README.md              # 本说明文档
├── run_tests.py          # 快速运行测试脚本
├── test_all_apis.py      # 完整的API测试脚本
├── interface_urls.md     # 详细的接口清单文档
├── test_results.json     # 测试结果(运行后生成)
└── test_qrcode.png       # 测试二维码(运行后生成)
```

## 🚀 快速开始

### 运行完整测试
```bash
cd api_tests
python run_tests.py
```

### 直接运行测试脚本
```bash
cd api_tests  
python test_all_apis.py
```

## 📋 测试内容

### 🔐 登录认证测试
- ✅ 获取登录页面
- ✅ 获取登录二维码
- ✅ 检查二维码状态

### 🛍️ 商品信息测试
- ⚠️ 获取商品详情 (可能过时)
- ⚠️ 查询商品库存 (可能过时)

### 🛒 购物车操作测试
- ⚠️ 清空购物车选中
- ⚠️ 添加商品到购物车

### 📋 订单相关测试
- ⚠️ 获取订单结算页面

### 🌐 外部接口测试
- ✅ 微信通知接口可达性

## 📊 测试结果解读

### ✅ PASS - 接口正常
- 接口可以正常访问
- 返回预期的数据格式
- 无需更新

### ❌ FAIL - 接口异常
- 可能的原因：
  1. 接口地址已更新
  2. 参数格式发生变化
  3. 新增验证机制
  4. 需要特殊的请求头

## 🔧 故障排查

### 1. 商品详情接口失败
**症状**: `https://item-soa.jd.com/getWareBusiness` 返回非JSON数据

**解决方案**:
1. 使用浏览器访问京东商品页面
2. F12打开开发者工具，网络选项卡
3. 查找商品详情相关的API请求
4. 对比新旧接口的差异
5. 更新接口地址和参数

### 2. 购物车接口失败
**症状**: `https://api.m.jd.com/api` 相关请求失败

**解决方案**:
1. 在京东网站添加商品到购物车
2. 抓包分析实际的API调用
3. 检查functionId是否有变化
4. 更新请求参数格式

### 3. 登录相关接口失败
**症状**: 二维码获取或验证失败

**解决方案**:
1. 检查京东登录页面是否有更新
2. 对比二维码接口的参数变化
3. 更新相关的cookie和token机制

## 📝 使用建议

1. **定期运行测试**: 建议每周运行一次，及时发现接口变化
2. **重点关注失败项**: 优先修复标记为❌的接口
3. **参考浏览器抓包**: 使用F12开发者工具是最可靠的方法
4. **保存测试记录**: 测试结果会自动保存到`test_results.json`

## 🔍 接口更新指南

当接口测试失败时，按以下步骤更新：

1. **抓包分析**
   ```bash
   # 在京东网站执行相应操作
   # 使用浏览器F12查看网络请求
   ```

2. **对比差异**
   - URL地址是否变化
   - 请求参数是否调整
   - 响应格式是否更新

3. **更新代码**
   - 修改`JdSession.py`中的对应方法
   - 更新接口地址和参数
   - 适配新的响应格式

4. **验证修复**
   ```bash
   python test_all_apis.py
   ```

## 💡 提示

- 测试不需要真实登录，主要验证接口可达性
- 如需测试完整流程，请使用主程序
- 测试结果仅供参考，实际使用时可能还需要登录状态 